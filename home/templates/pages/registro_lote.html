{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
  {% include 'partials/_head.html' %}
</head>
<body>

{% include 'partials/_nav.html' %}

<section class="content-wrapper" style="margin-top: 15px;">
  <div class="header-bar">
    Matrícula em Lote (Irmãos)
  </div>

  <div class="tab-buttons">
    <button data-tab="0" onclick="showTab(0)" type="button">Alunos</button>
    <button data-tab="1" onclick="showTab(1)" type="button">Dados dos Responsáveis</button>
    <button data-tab="2" onclick="showTab(2)" type="button">Saúde</button>
    <button data-tab="3" onclick="showTab(3)" type="button">Transporte</button>
    <button data-tab="4" onclick="showTab(4)" type="button">Autorizações</button>
  </div>

  <form id="formCadastroLote">
    {% csrf_token %}

    <!-- ================= TAB 0 ================= -->
    <div class="tab-section" data-tab="0">
      <h3>Alunos</h3>

      <div id="alunos-container">

        <!-- ===== ALUNO 1 ===== -->
        <div class="aluno-bloco" data-index="0">
          <h4>
          <span class="titulo-aluno">Aluno 1</span>
        </h4>
          <!-- Matrícula / Nome / Data -->
          <div class="form-row row">
            <div class="form-group col-md-2">
              <label>Matrícula</label>
              <input
                type="text"
                name="alunos[0][matricula]"
                class="form-control"
                placeholder="Gerada"
                readonly>
            </div>

            <div class="form-group col-md-8">
              <label>Nome</label>
              <input
                type="text"
                name="alunos[0][nome]"
                class="form-control">
            </div>

            <div class="form-group col-md-2">
              <label>Data nasc.</label>
              <input
                type="date"
                name="alunos[0][data_nascimento]"
                class="form-control">
            </div>
          </div>

          <!-- CPF / RG / Sexo (CORRIGIDO) -->
          <div class="form-row row">
            <div class="form-group col-md-4">
              <label>CPF</label>
              <input
                type="text"
                name="alunos[0][cpf]"
                class="form-control">
            </div>

            <div class="form-group col-md-4">
              <label>RG</label>
              <input
                type="text"
                name="alunos[0][rg]"
                class="form-control">
            </div>

            <div class="form-group col-md-4">
              <label>Sexo</label>
              <select
                name="alunos[0][sexo]"
                class="form-control">
                <option value="">Selecione</option>
                <option value="Masculino">Masculino</option>
                <option value="Feminino">Feminino</option>
              </select>
            </div>
          </div>

          <!-- Série / Turno / Turma -->
          <div class="form-row row">
            <div class="form-group col-md-4">
              <label>Série/Ano</label>
              <input
                type="text"
                name="alunos[0][serie_ano]"
                class="form-control">
            </div>

            <div class="form-group col-md-4">
              <label>Turno</label>
              <select
                name="alunos[0][turno_aluno]"
                class="form-control">
                <option value="">Selecione</option>
                <option value="Matutino">Matutino</option>
                <option value="Vespertino">Vespertino</option>
                <option value="Integral">Integral</option>
              </select>
            </div>

            <div class="form-group col-md-4">
              <label>Turma</label>
              <select
                name="alunos[0][turma_principal_id]"
                class="form-control">
                <option value="">Selecione</option>
                {% for t in turmas %}
                  <option value="{{ t.id }}">{{ t.nome }}</option>
                {% endfor %}
              </select>
            </div>
          </div>

          <hr>
        </div>
      </div>

      <button
        type="button"
        class="btn btn-secondary"
        id="addAlunoBtn">
        + Adicionar outro aluno
      </button>
    </div>

    <!-- ================= OUTRAS TABS ================= -->
    <div class="tab-section" data-tab="1" style="display:none">
      {% include 'partials/alunos/_responsaveis.html' %}
    </div>

    <div class="tab-section" data-tab="2" style="display:none">
      <h3>Saúde</h3>
      <div class="aluno-saude" data-index="0">
        <h4>Aluno 1</h4>
        {% include 'partials/alunos/_saude.html' %}
      </div>
    </div>

    <div class="tab-section" data-tab="3" style="display:none">
      <h3>Transporte</h3>
      <div class="aluno-transporte" data-index="0">
        <h4>Aluno 1</h4>
        {% include 'partials/alunos/_transporte.html' %}
      </div>
    </div>

    <div class="tab-section" data-tab="4" style="display:none">
      <h3>Autorizações</h3>
      <div class="aluno-autorizacoes" data-index="0">
        <h4>Aluno 1</h4>
        {% include 'partials/alunos/_autorizacoes.html' %}
      </div>
    </div>

    <!-- FOOTER -->
    <div class="form-footer" style="display:flex; gap:8px;">
      <button class="btn btn-secondary" type="button" onclick="goBack()">Voltar</button>
      <button class="btn btn-light" type="button" onclick="cancelForm()">Cancelar</button>
      <button class="btn btn-primary" id="submitButton" type="button">
        Salvar Matrículas
      </button>
    </div>

  </form>
</section>

<footer>
  {% include 'partials/_footer.html' %}
  <script src="{% static 'home/js/registro_lote.js' %}"></script>
</footer>

<script>
function showTab(index) {
  const tabs = document.querySelectorAll('.tab-section');
  const btns = document.querySelectorAll('.tab-buttons [data-tab]');

  tabs.forEach(tab => {
    tab.style.display = tab.dataset.tab == index ? 'block' : 'none';
  });

  btns.forEach(btn => {
    btn.classList.toggle('active', btn.dataset.tab == index);
  });
}

showTab(0);

function goBack(){ window.history.back(); }
function cancelForm(){ window.location.href = document.referrer || '/'; }
</script>

</body>
</html>
